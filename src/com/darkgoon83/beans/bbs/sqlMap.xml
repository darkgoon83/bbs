<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="beans.board">

	<typeAlias alias="board" type="kr.co.fusionsoft.beans.board.Board" />
	<typeAlias alias="BoardSearchCondition" type="kr.co.fusionsoft.beans.board.BoardSearchCondition" />
	<typeAlias alias="boardFile" type="kr.co.fusionsoft.beans.board.BoardFile" />
	<typeAlias alias="boardComment" type="kr.co.fusionsoft.beans.board.BoardComment" />
	<typeAlias alias="boardReport" type="kr.co.fusionsoft.beans.wikiadm.board.boardFilter.report.BoardReport" />
	<typeAlias alias="boardRecom" type="kr.co.fusionsoft.beans.board.BoardRecom" />

	<sql id="boardField">
		BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
		PARENT_SEQ , GROUP_STEP , TITLE ,
		CONTENT , USER_ID ,	USER_NAME ,
		USER_EMAIL , USER_HOMEPAGE , USER_PHONE ,
		USER_IP , VIEW_COUNT , MODIFY_ID ,
		NOTICE_YN , NOTICE_START_DATE , NOTICE_END_DATE ,
		CRT_DT , UPT_DT , UPT_DT2, CATEGORY1 ,
		DEL_DT  , PREVIEW_CONTENT ,	DELETE_ID,
		PREVIEW_IMG , PREVIEW_IMG_NAME , BOARD_FILE_COUNT ,
		SECRET_YN , CATEGORY2 , CATEGORY3 ,
		CATEGORY4 , CATEGORY5 , BOARD_FILE_DOWNLOAD_COUNT,
		RECOM_COUNT,
		IMSI_V_1, IMSI_V_2, IMSI_V_3, IMSI_V_4, IMSI_V_5,
		IMSI_D_1, IMSI_D_2,
		IMSI_N_1, IMSI_N_2,
		USER_EMAIL_RECEIVE_YN, USER_SMS_RECEIVE_YN
	</sql>

	<sql id="boardListField">
		BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
		PARENT_SEQ , GROUP_STEP , TITLE ,
		USER_ID , USER_NAME , USER_EMAIL ,
		USER_IP , VIEW_COUNT , NOTICE_YN ,
		NOTICE_START_DATE , NOTICE_END_DATE , CRT_DT ,
		CATEGORY1 , DEL_DT  ,
		PREVIEW_IMG , PREVIEW_IMG_NAME ,
		BOARD_FILE_COUNT , SECRET_YN , CATEGORY2 ,
		CATEGORY3 , CATEGORY4 , CATEGORY5 ,
		PREVIEW_CONTENT , BOARD_FILE_DOWNLOAD_COUNT,
		RECOM_COUNT,
		IMSI_V_1, IMSI_V_2, IMSI_V_3, IMSI_V_4, IMSI_V_5,
		IMSI_D_1, IMSI_D_2,
		IMSI_N_1, IMSI_N_2,
		USER_EMAIL_RECEIVE_YN, USER_SMS_RECEIVE_YN, USER_PHONE
	</sql>

	<sql id="boardListFieldContent">
		BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
		PARENT_SEQ , GROUP_STEP , TITLE ,
		USER_ID , USER_NAME , USER_EMAIL ,
		USER_IP , VIEW_COUNT , NOTICE_YN ,
		NOTICE_START_DATE , NOTICE_END_DATE , CRT_DT ,
		FS_FN_CODENAME((SELECT BOARD_CATEGORY1 FROM BOARD_MANAGER WHERE BOARD_MANAGER.MANAGER_SEQ = BOARD.MANAGER_SEQ) ,CATEGORY1)AS CATEGORY1 ,
		DEL_DT , PREVIEW_IMG , PREVIEW_IMG_NAME ,
		BOARD_FILE_COUNT , SECRET_YN , CATEGORY2 ,
		CATEGORY3 , CATEGORY4 , CATEGORY5 ,
		PREVIEW_CONTENT , BOARD_FILE_DOWNLOAD_COUNT,
		RECOM_COUNT, CONTENT,
		IMSI_V_1, IMSI_V_2, IMSI_V_3, IMSI_V_4, IMSI_V_5,
		IMSI_D_1, IMSI_D_2,
		IMSI_N_1, IMSI_N_2,
		USER_EMAIL_RECEIVE_YN, USER_SMS_RECEIVE_YN, USER_PHONE
	</sql>

	<sql id="boardNextField">
		BOARD_SEQ , TITLE , PARENT_SEQ ,
		GROUP_SEQ , CRT_DT
		<isNotEmpty property="mainSelectField" open=",">
			$mainSelectField$
		</isNotEmpty>
	</sql>

	<sql id="boardFileField">
		FILE_SEQ , BOARD_SEQ , REAL_FILE_NAME ,
		RENAME_FILE_NAME , FILE_SIZE , FILE_EXT ,
		FILE_ADD_DATE
	</sql>

	<sql id="boardCommentField">
		COMMENT_SEQ , BOARD_SEQ , COMMENT_ADD_USER_ID ,
		COMMENT_ADD_USER_NAME , COMMENT_CRT_DT , COMMENT_CONTENT, EMOTICON
	</sql>

	<sql id="boardReportField">
		REP_SEQ, BOARD_SEQ, USER_ID, CONTENT, REP_DT
	</sql>

	<sql id="boardRecomField">
		RECOM_SEQ, BOARD_SEQ, USER_ID, RECOM_DT
	</sql>

	<sql id="selectBoardWhere">
		$board_add_where$
		<isNotEmpty prepend="AND" property="find">
			<isEqual property="find" compareValue="title_content">
			( DBMS_LOB.INSTR(CONTENT , #search#)>0 OR TITLE LIKE '%'||#search#||'%' )
			</isEqual>
			<isNotEqual property="find" compareValue="title_content">
			$find$ like '%'||#search#||'%'
			</isNotEqual>
		</isNotEmpty>
	    <!-- <isEqual prepend="AND" property="self_view_yn" compareValue="Y">
	     	USER_ID = #self_member_id#
	    </isEqual> -->
		<isNotEmpty prepend="AND" property="category1">
			CATEGORY1 = #category1#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="category2">
			CATEGORY2 = #category2#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="category3">
			CATEGORY3 = #category3#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="category4">
			CATEGORY4 = #category4#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="category5">
			CATEGORY5 = #category5#
		</isNotEmpty>
	</sql>

	<!-- 메인화면에 보여질 목록 -->
	<select id="selectBoardToMain" resultClass="board" remapResults="true">
	SELECT * FROM
	(
		SELECT <include refid="boardNextField"/> , ROWNUM RN FROM
		(
			SELECT
			<include refid="boardNextField"/>
			FROM
				BOARD
			WHERE (MANAGER_SEQ = #manager_seq#
				  $join_manager_seq$)
			AND	  DEL_DT IS NULL
			<isNotEmpty property="category1" prepend="AND">
			CATEGORY1 = #category1#
			</isNotEmpty>
			<isNotEmpty property="where" prepend="AND">
			$where$
			</isNotEmpty>
			ORDER BY
	        	GROUP_SEQ DESC ,
	        	BOARD_SEQ ASC
	    )
	) WHERE RN &lt;= #rowSize#  ORDER BY RN ASC
	</select>

	<!-- 게시물 목록 -->
	<select id="selectBoard" resultClass="board">
		$connectPagingHead$
			SELECT
				<include refid="boardListField"/>
				<isEqual property="use_comment_count" compareValue="true">
				, ( select count(*) as cnt from board_comment where board_comment.board_seq = board.board_seq ) as comment_count
				</isEqual>
				<isEqual property="use_comment_count" compareValue="false">
				, 0 as comment_count
				</isEqual>
			FROM
				BOARD
			WHERE
				<isNotEmpty property="board_join">
					MANAGER_SEQ in ( #manager_seq#,$board_join$ )
				</isNotEmpty>
				<isEmpty property="board_join">
					MANAGER_SEQ = #manager_seq#
				</isEmpty>
				AND DEL_DT IS NULL
				<include refid="selectBoardWhere"/>
		$connectPagingTail$
	</select>

	<!-- 게시물 갯수 -->
	<select id="selectBoardCount" resultClass="int">
		SELECT
			COUNT(*)
		FROM
		(
			SELECT
				BOARD_SEQ ,
				PARENT_SEQ
            FROM
                BOARD
			WHERE
				<isNotEmpty property="board_join">
					MANAGER_SEQ in ( #manager_seq#,$board_join$ )
				</isNotEmpty>
				<isEmpty property="board_join">
					MANAGER_SEQ = #manager_seq#
				</isEmpty>
				AND	DEL_DT IS NULL
				<include refid="selectBoardWhere"/>
		) TARGETTABLEROW	CONNECT
            BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
	</select>

	<!-- 상담 게시판에서 사용되는 게시물 목록 -->
	<select id="selectQnABoard" resultClass="board">
		$connectPagingHead$
			SELECT
			<include refid="boardListField"/>
			,(SELECT COUNT(*) FROM BOARD WHERE PARENT_SEQ = P_BOARD.BOARD_SEQ AND DEL_DT IS NULL) AS CHILD_COUNT
			FROM
				BOARD P_BOARD
			WHERE
				MANAGER_SEQ = #manager_seq# AND
				GROUP_STEP = 0 AND
				DEL_DT IS NULL
				<include refid="selectBoardWhere"/>
		$connectPagingTail$
	</select>

<!-- 해당메뉴가 260일 경우에 60~71번과 77번 게시물을 함께 가져온다.(이용자지원센타 내문의내역) -->
	<select id="selectBoardQna" resultClass="board">
		$pagingHead$
		SELECT $orderByNO$ A.*   FROM
		(
			SELECT
				BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
				PARENT_SEQ , GROUP_STEP , TITLE ,
				USER_ID , USER_NAME , USER_EMAIL ,
				USER_IP , VIEW_COUNT , NOTICE_YN ,
				NOTICE_START_DATE , NOTICE_END_DATE , CRT_DT ,
				<isEqual property="manager_seq" compareValue="77">
				FS_FN_CODENAME((SELECT BOARD_CATEGORY1 FROM BOARD_MANAGER WHERE BOARD_MANAGER.MANAGER_SEQ = BOARD.MANAGER_SEQ) ,CATEGORY1)AS CATEGORY1 ,
				</isEqual>
				DEL_DT  ,
				PREVIEW_IMG , PREVIEW_IMG_NAME ,
				BOARD_FILE_COUNT , SECRET_YN , CATEGORY2 ,
				CATEGORY3 , CATEGORY4 , CATEGORY5 ,
				PREVIEW_CONTENT , BOARD_FILE_DOWNLOAD_COUNT,
				RECOM_COUNT, CONTENT,
				IMSI_V_1, IMSI_V_2, IMSI_V_3, IMSI_V_4, IMSI_V_5,
				IMSI_D_1, IMSI_D_2,
				IMSI_N_1, IMSI_N_2, USER_EMAIL_RECEIVE_YN, USER_SMS_RECEIVE_YN ,
				( SELECT COUNT(*) AS CNT FROM BOARD_COMMENT WHERE BOARD_COMMENT.BOARD_SEQ = BOARD.BOARD_SEQ ) AS COMMENT_COUNT ,
				( SELECT CRT_DT FROM BOARD B WHERE B.PARENT_SEQ = BOARD.GROUP_SEQ AND ROWNUM = 1) AS REPLY_CRT_DT ,
				( SELECT CONTENT FROM BOARD B WHERE B.PARENT_SEQ = BOARD.GROUP_SEQ AND ROWNUM = 1) AS REPLY_CONTENT
			FROM
				BOARD
			WHERE
				(
					MANAGER_SEQ = 60 OR
					MANAGER_SEQ = 61 OR
					MANAGER_SEQ = 62 OR
					MANAGER_SEQ = 68 OR
					MANAGER_SEQ = 69 OR
					MANAGER_SEQ = 70 OR
					MANAGER_SEQ = 81 OR
					MANAGER_SEQ = 82 OR
					MANAGER_SEQ = 77
				) AND
				PARENT_SEQ = 0 AND
				DEL_DT IS NULL AND
				USER_ID like #user_id#
				<include refid="selectBoardWhere"/>
				ORDER BY
                GROUP_SEQ DESC ,
                BOARD_SEQ ASC
		) A
		$pagingTail$
	</select>
	
	<!-- 관리자 메뉴에서 사용되는 이용자지원센타 내문의내역 -->
	<select id="selectBoardQnaAdmin" resultClass="board">
		$pagingHead$
		SELECT $orderByNO$ A.*   FROM
		(
			SELECT
				BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
				PARENT_SEQ , GROUP_STEP , TITLE ,
				USER_ID , USER_NAME , USER_EMAIL ,
				USER_IP , VIEW_COUNT , NOTICE_YN ,
				NOTICE_START_DATE , NOTICE_END_DATE , CRT_DT ,
				<isEqual property="manager_seq" compareValue="77">
				FS_FN_CODENAME((SELECT BOARD_CATEGORY1 FROM BOARD_MANAGER WHERE BOARD_MANAGER.MANAGER_SEQ = BOARD.MANAGER_SEQ) ,CATEGORY1)AS CATEGORY1 ,
				</isEqual>
				DEL_DT  ,
				PREVIEW_IMG , PREVIEW_IMG_NAME ,
				BOARD_FILE_COUNT , SECRET_YN , CATEGORY2 ,
				CATEGORY3 , CATEGORY4 , CATEGORY5 ,
				PREVIEW_CONTENT , BOARD_FILE_DOWNLOAD_COUNT,
				RECOM_COUNT, CONTENT,
				IMSI_V_1, IMSI_V_2, IMSI_V_3, IMSI_V_4, IMSI_V_5,
				IMSI_D_1, IMSI_D_2,
				IMSI_N_1, IMSI_N_2, USER_EMAIL_RECEIVE_YN, USER_SMS_RECEIVE_YN ,
				( SELECT COUNT(*) AS CNT FROM BOARD_COMMENT WHERE BOARD_COMMENT.BOARD_SEQ = BOARD.BOARD_SEQ ) AS COMMENT_COUNT ,
				( SELECT CRT_DT FROM BOARD B WHERE B.PARENT_SEQ = BOARD.GROUP_SEQ AND ROWNUM = 1) AS REPLY_CRT_DT ,
				( SELECT CONTENT FROM BOARD B WHERE B.PARENT_SEQ = BOARD.GROUP_SEQ AND ROWNUM = 1) AS REPLY_CONTENT
			FROM
				BOARD
			WHERE
				MANAGER_SEQ = #manager_seq# AND
				PARENT_SEQ = 0 AND
				DEL_DT IS NULL 
				<include refid="selectBoardWhere"/>
				ORDER BY
                GROUP_SEQ DESC ,
                BOARD_SEQ ASC
		) A
		$pagingTail$
	</select>

	<!-- 해당메뉴가 260일 경우에 60번과 77번 게시물의 갯수를 함께 가져온다.(이용자지원센타 내문의내역) -->
	<select id="selectBoardQnaCount" resultClass="int">
		SELECT
			COUNT(*)
		FROM
		(
			SELECT
				BOARD_SEQ ,
				PARENT_SEQ
            FROM
                BOARD
			WHERE
				(
					MANAGER_SEQ = 60 OR
					MANAGER_SEQ = 61 OR
					MANAGER_SEQ = 62 OR
					MANAGER_SEQ = 68 OR
					MANAGER_SEQ = 69 OR
					MANAGER_SEQ = 70 OR
					MANAGER_SEQ = 81 OR
					MANAGER_SEQ = 82 OR
					MANAGER_SEQ = 77
				) AND
				PARENT_SEQ = 0 AND
				DEL_DT IS NULL AND
				USER_ID like #user_id#
				<include refid="selectBoardWhere"/>
		)
	</select>
	
	<!-- 관리자에서 사용되는 이용자지원센타 내문의내역 -->
	<select id="selectBoardQnaAdminCount" resultClass="int">
		SELECT
			COUNT(*)
		FROM
		(
			SELECT
				BOARD_SEQ ,
				PARENT_SEQ
            FROM
                BOARD
			WHERE
				MANAGER_SEQ = #manager_seq# AND
				PARENT_SEQ = 0 AND
				DEL_DT IS NULL
				<include refid="selectBoardWhere"/>
		)
	</select>

	<!-- 게시물 갯수 -->
	<select id="selectQnABoardCount" resultClass="int">
		SELECT
			COUNT(*)
		FROM
			BOARD
		WHERE
			MANAGER_SEQ = #manager_seq# AND
			GROUP_STEP = 0 AND
			DEL_DT IS NULL AND
			<include refid="selectBoardWhere"/>
	</select>

	<!-- 삭제 게시물 목록 -->
	<select id="selectDeleteBoard" resultClass="board">
	$pagingHead$
	SELECT
		$orderByNO$
		<include refid="boardListField"/>
		FROM
		(
			SELECT
			$orderByNO$
			<include refid="boardListField"/>
			FROM
				BOARD
			WHERE
				MANAGER_SEQ = #manager_seq# AND
				DEL_DT IS NOT NULL
				<include refid="selectBoardWhere"/>
			ORDER BY
	        	GROUP_SEQ DESC ,
	        	BOARD_SEQ ASC
	    ) TARGETTABLEROW
	$pagingTail$
	</select>

	<!-- 삭제 게시물 갯수 -->
	<select id="selectDeleteBoardCount" resultClass="int">
		SELECT
			COUNT(*)
		FROM
			BOARD
		WHERE
			MANAGER_SEQ = #manager_seq# AND
			DEL_DT IS NOT NULL
			<include refid="selectBoardWhere"/>
	</select>

	<!-- 공지사항 목록 -->
	<select id="selectNoticeBoard" resultClass="board">
		SELECT
		<include refid="boardField"/>
		FROM
			BOARD
		WHERE
			MANAGER_SEQ = #manager_seq# AND
			DEL_DT IS NULL AND
			NOTICE_YN = 'Y' AND
			(TO_CHAR(NOTICE_START_DATE,'yyyy-MM-dd') <![CDATA[<=]]> TO_CHAR(SYSDATE,'yyyy-MM-dd') OR NOTICE_START_DATE IS NULL) AND
			(TO_CHAR(NOTICE_END_DATE,'yyyy-MM-dd') <![CDATA[>=]]> TO_CHAR(SYSDATE,'yyyy-MM-dd') OR NOTICE_END_DATE IS NULL)
		ORDER BY BOARD_SEQ ASC
	</select>

	<!-- 해당 그룹번호 목록을 가져온다. -->
	<select id="selectGroupBoard" resultClass="board">
		SELECT
		<include refid="boardField"/>
		FROM
			BOARD
			WHERE
				GROUP_SEQ = #board_seq#
			ORDER BY BOARD_SEQ ASC
	</select>

	<!-- 게시물 상세정보 -->
	<select id="boardInfo" parameterClass="int" resultClass="board">
		SELECT
		<include refid="boardField"/>
		FROM
			BOARD
		WHERE BOARD_SEQ = #board_seq#
	</select>

	<!-- 해당 게시판의 첫번째 게시물을 가져온다.(메일 보내기용) -->
	<select id="boardFirstInfo" parameterClass="int" resultClass="board">
		SELECT
		<include refid="boardField"/>
		FROM
			BOARD
		WHERE
			MANAGER_SEQ = #manager_seq# AND
			ROWNUM = 1
		ORDER BY BOARD_SEQ DESC
	</select>


	<!-- 게시물 상세정보 -->
	<select id="boardQnAInfo" resultClass="board">
		SELECT
			BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
			PARENT_SEQ , GROUP_STEP , TITLE ,
			CONTENT , USER_ID ,	USER_NAME ,
			USER_EMAIL , USER_HOMEPAGE , USER_PHONE ,
			USER_IP , VIEW_COUNT , MODIFY_ID ,
			NOTICE_YN , NOTICE_START_DATE , NOTICE_END_DATE ,
			CRT_DT , UPT_DT , FS_FN_CODENAME('$categoryCode1$',CATEGORY1)CATEGORY1 ,
			DEL_DT  , PREVIEW_CONTENT,
			PREVIEW_IMG , PREVIEW_IMG_NAME , BOARD_FILE_COUNT ,
			SECRET_YN , FS_FN_CODENAME('$categoryCode2$',CATEGORY2)CATEGORY2 , CATEGORY3 ,
			CATEGORY4 , CATEGORY5,
			RECOM_COUNT,
			IMSI_V_1, IMSI_V_2, IMSI_V_3, IMSI_V_4, IMSI_V_5,
			IMSI_D_1, IMSI_D_2,
			IMSI_N_1, IMSI_N_2, USER_EMAIL_RECEIVE_YN, USER_SMS_RECEIVE_YN
		FROM
			BOARD
		WHERE BOARD_SEQ = #board_seq#
	</select>

	<!-- 상담 게시판에서 사용되는 상세정보 -->
	<select id="boardReplyInfo" parameterClass="int" resultClass="board">
		SELECT
		<include refid="boardField"/>
		FROM
			BOARD
		WHERE PARENT_SEQ = #board_seq#	AND
			  DEL_DT IS NULL AND
		ROWNUM = 1 ORDER BY BOARD_SEQ ASC
	</select>

	<!-- 게시물 다음글 가져오기 -->
	<select id="boardNextView" parameterClass="board" resultClass="board">
		SELECT * FROM
		(
		    SELECT * FROM
		    (
		        SELECT A_BOARD.*,ROWNUM RN FROM
		        (
		            SELECT * FROM
		            (
		                SELECT BOARD_SEQ , TITLE , PARENT_SEQ , GROUP_SEQ , CRT_DT , GROUP_STEP FROM BOARD
		                WHERE
		                    MANAGER_SEQ = #manager_seq# AND
		                    DEL_DT IS NULL
		            )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		            ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		        ) A_BOARD
		    ) WHERE RN <![CDATA[>]]>
		     (
		         SELECT RN FROM
		         (
		             SELECT B_BOARD.*,ROWNUM RN FROM
		             (
		                 SELECT * FROM
		                 (
		                     SELECT BOARD_SEQ , PARENT_SEQ , GROUP_SEQ , GROUP_STEP FROM BOARD
		                     WHERE
		                         MANAGER_SEQ = #manager_seq# AND
		                         DEL_DT IS NULL
		                 )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		                 ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		             ) B_BOARD
		         ) WHERE BOARD_SEQ = #board_seq#
		     ) ORDER BY RN ASC
		 ) WHERE ROWNUM = 1
	</select>

	<!-- 게시물 이전글 가져오기 -->
	<select id="boardPreView" parameterClass="board" resultClass="board">
		SELECT * FROM
		(
		    SELECT * FROM
		    (
		        SELECT A_BOARD.*,ROWNUM RN FROM
		        (
		            SELECT * FROM
		            (
		                SELECT BOARD_SEQ , TITLE , PARENT_SEQ , GROUP_SEQ , CRT_DT , GROUP_STEP FROM BOARD
		                WHERE
		                    MANAGER_SEQ = #manager_seq# AND
		                    DEL_DT IS NULL
		            )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		            ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		        ) A_BOARD
		    ) WHERE RN <![CDATA[<]]>
		     (
		         SELECT RN FROM
		         (
		             SELECT B_BOARD.*,ROWNUM RN FROM
		             (
		                 SELECT * FROM
		                 (
		                     SELECT BOARD_SEQ , PARENT_SEQ , GROUP_SEQ , GROUP_STEP FROM BOARD
		                     WHERE
		                         MANAGER_SEQ = #manager_seq# AND
		                         DEL_DT IS NULL
		                 )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		                 ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		             ) B_BOARD
		         ) WHERE BOARD_SEQ = #board_seq#
		     ) ORDER BY RN DESC
		 ) WHERE ROWNUM = 1
	</select>

	<!-- 게시물 등록 -->
	<insert id="addBoard" parameterClass="board">
		INSERT INTO BOARD
		(
			BOARD_SEQ , MANAGER_SEQ , GROUP_SEQ ,
			PARENT_SEQ , GROUP_STEP , TITLE ,
			USER_ID , USER_IP ,
			VIEW_COUNT , UPT_DT , UPT_DT2 , CRT_DT
		<dynamic prepend=",">
			<isNotEmpty property="user_name" prepend=",">
			USER_NAME
			</isNotEmpty>
			<isNotEmpty property="user_email" prepend=",">
			USER_EMAIL
			</isNotEmpty>
			<isNotEmpty property="user_homepage" prepend=",">
			USER_HOMEPAGE
			</isNotEmpty>
			<isNotEmpty property="user_phone" prepend=",">
			USER_PHONE
			</isNotEmpty>
			<isNotEmpty property="notice_yn" prepend=",">
			NOTICE_YN
			</isNotEmpty>
			<isNotEmpty property="secret_yn" prepend=",">
			SECRET_YN
			</isNotEmpty>
			<isNotEmpty property="notice_start_date" prepend=",">
			NOTICE_START_DATE
			</isNotEmpty>
			<isNotEmpty property="notice_end_date" prepend=",">
			NOTICE_END_DATE
			</isNotEmpty>
			<isNotEmpty property="category1" prepend=",">
			CATEGORY1
			</isNotEmpty>
			<isNotNull property="category2" prepend=",">
			CATEGORY2
			</isNotNull>
			<isNotNull property="category3" prepend=",">
			CATEGORY3
			</isNotNull>
			<isNotNull property="category4" prepend=",">
			CATEGORY4
			</isNotNull>
			<isNotNull property="category5" prepend=",">
			CATEGORY5
			</isNotNull>
			<isNotEmpty property="preview_content" prepend=",">
			PREVIEW_CONTENT
			</isNotEmpty>
			<isNotEmpty property="preview_img" prepend=",">
			PREVIEW_IMG
			</isNotEmpty>
			<isNotEmpty property="preview_img_name" prepend=",">
			PREVIEW_IMG_NAME
			</isNotEmpty>
			<isNotEmpty property="board_file_count" prepend=",">
			BOARD_FILE_COUNT
			</isNotEmpty>
			<isNotEmpty property="content" prepend=",">
			CONTENT
			</isNotEmpty>
			<isNotEmpty property="imsi_v_1" prepend=",">
			IMSI_V_1
			</isNotEmpty>
			<isNotEmpty property="imsi_v_2" prepend=",">
			IMSI_V_2
			</isNotEmpty>
			<isNotEmpty property="imsi_v_3" prepend=",">
			IMSI_V_3
			</isNotEmpty>
			<isNotEmpty property="imsi_v_4" prepend=",">
			IMSI_V_4
			</isNotEmpty>
			<isNotEmpty property="imsi_v_5" prepend=",">
			IMSI_V_5
			</isNotEmpty>
			<isNotEmpty property="imsi_d_1" prepend=",">
			IMSI_D_1
			</isNotEmpty>
			<isNotEmpty property="imsi_d_2" prepend=",">
			IMSI_D_2
			</isNotEmpty>
			<isNotEmpty property="imsi_n_1" prepend=",">
			IMSI_N_1
			</isNotEmpty>
			<isNotEmpty property="imsi_n_2" prepend=",">
			IMSI_N_2
			</isNotEmpty>
			<isNotEmpty property="user_email_receive_yn" prepend=",">
			USER_EMAIL_RECEIVE_YN
			</isNotEmpty>
			<isNotEmpty property="user_sms_receive_yn" prepend=",">
			USER_SMS_RECEIVE_YN
			</isNotEmpty>
		</dynamic>
		) VALUES (
			#board_seq# , #manager_seq# , #group_seq# ,
			#parent_seq# , #group_step# , #title# ,
			#user_id# ,	#user_ip# ,
			#view_count# , SYSDATE , SYSDATE , SYSDATE
		<dynamic prepend=",">
			<isNotEmpty property="user_name" prepend=",">
			#user_name#
			</isNotEmpty>
			<isNotEmpty property="user_email" prepend=",">
			#user_email#
			</isNotEmpty>
			<isNotEmpty property="user_homepage" prepend=",">
			#user_homepage#
			</isNotEmpty>
			<isNotEmpty property="user_phone" prepend=",">
			#user_phone#
			</isNotEmpty>
			<isNotEmpty property="notice_yn" prepend=",">
			#notice_yn#
			</isNotEmpty>
			<isNotEmpty property="secret_yn" prepend=",">
			#secret_yn#
			</isNotEmpty>
			<isNotEmpty property="notice_start_date" prepend=",">
			#notice_start_date#
			</isNotEmpty>
			<isNotEmpty property="notice_end_date" prepend=",">
			#notice_end_date#
			</isNotEmpty>
			<isNotEmpty property="category1" prepend=",">
			#category1#
			</isNotEmpty>
			<isNotNull property="category2" prepend=",">
			#category2#
			</isNotNull>
			<isNotNull property="category3" prepend=",">
			#category3#
			</isNotNull>
			<isNotNull property="category4" prepend=",">
			#category4#
			</isNotNull>
			<isNotNull property="category5" prepend=",">
			#category5#
			</isNotNull>
			<isNotEmpty property="preview_content" prepend=",">
			#preview_content#
			</isNotEmpty>
			<isNotEmpty property="preview_img" prepend=",">
			#preview_img#
			</isNotEmpty>
			<isNotEmpty property="preview_img_name" prepend=",">
			#preview_img_name#
			</isNotEmpty>
			<isNotEmpty property="board_file_count" prepend=",">
			#board_file_count#
			</isNotEmpty>
			<isNotEmpty property="content" prepend=",">
			#content#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_1" prepend=",">
			#imsi_v_1#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_2" prepend=",">
			#imsi_v_2#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_3" prepend=",">
			#imsi_v_3#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_4" prepend=",">
			#imsi_v_4#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_5" prepend=",">
			#imsi_v_5#
			</isNotEmpty>
			<isNotEmpty property="imsi_d_1" prepend=",">
			#imsi_d_1#
			</isNotEmpty>
			<isNotEmpty property="imsi_d_2" prepend=",">
			#imsi_d_2#
			</isNotEmpty>
			<isNotEmpty property="imsi_n_1" prepend=",">
			#imsi_n_1#
			</isNotEmpty>
			<isNotEmpty property="imsi_n_2" prepend=",">
			#imsi_n_2#
			</isNotEmpty>
			<isNotEmpty property="user_email_receive_yn" prepend=",">
			#user_email_receive_yn#
			</isNotEmpty>
			<isNotEmpty property="user_sms_receive_yn" prepend=",">
			#user_sms_receive_yn#
			</isNotEmpty>
		</dynamic>
		)
	</insert>

	<!-- 게시물 수정 -->
	<update id="modifyBoard" parameterClass="board">
		UPDATE BOARD SET
			TITLE = #title# , MODIFY_ID = #modify_id# ,
			UPT_DT = UPT_DT2, UPT_DT2 = SYSDATE
		<dynamic prepend=",">
			<isNotEmpty property="user_name" prepend=",">
			USER_NAME = #user_name#
			</isNotEmpty>
			<isNotEmpty property="user_email" prepend=",">
			USER_EMAIL = #user_email#
			</isNotEmpty>
			<isNotEmpty property="user_homepage" prepend=",">
			USER_HOMEPAGE = #user_homepage#
			</isNotEmpty>
			<isNotEmpty property="user_phone" prepend=",">
			USER_PHONE = #user_phone#
			</isNotEmpty>
			<isNotEmpty property="notice_yn" prepend=",">
			NOTICE_YN = #notice_yn#
			</isNotEmpty>
			<isNotEmpty property="secret_yn" prepend=",">
			SECRET_YN = #secret_yn#
			</isNotEmpty>
			<isNotEmpty property="notice_start_date" prepend=",">
			NOTICE_START_DATE = #notice_start_date#
			</isNotEmpty>
			<isNotEmpty property="notice_end_date" prepend=",">
			NOTICE_END_DATE = #notice_end_date#
			</isNotEmpty>
			<isNotEmpty property="category1" prepend=",">
			CATEGORY1 = #category1#
			</isNotEmpty>
			<isNotNull property="category2" prepend=",">
			CATEGORY2 = #category2#
			</isNotNull>
			<isNotNull property="category3" prepend=",">
			CATEGORY3 = #category3#
			</isNotNull>
			<isNotNull property="category4" prepend=",">
			CATEGORY4 = #category4#
			</isNotNull>
			<isNotNull property="category5" prepend=",">
			CATEGORY5 = #category5#
			</isNotNull>
			<isNotEmpty property="preview_content" prepend=",">
			PREVIEW_CONTENT = #preview_content#
			</isNotEmpty>
			<isNotEmpty property="preview_img" prepend=",">
			PREVIEW_IMG = #preview_img#
			</isNotEmpty>
			<isNotEmpty property="preview_img_name" prepend=",">
			PREVIEW_IMG_NAME = #preview_img_name#
			</isNotEmpty>
			<isNotEmpty property="board_file_count" prepend=",">
			BOARD_FILE_COUNT = #board_file_count#
			</isNotEmpty>
			<isNotEmpty property="content" prepend=",">
			CONTENT = #content#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_1" prepend=",">
			IMSI_V_1 = #imsi_v_1#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_2" prepend=",">
			IMSI_V_2 = #imsi_v_2#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_3" prepend=",">
			IMSI_V_3 = #imsi_v_3#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_4" prepend=",">
			IMSI_V_4 = #imsi_v_4#
			</isNotEmpty>
			<isNotEmpty property="imsi_v_5" prepend=",">
			IMSI_V_5 = #imsi_v_5#
			</isNotEmpty>
			<isNotEmpty property="imsi_d_1" prepend=",">
			IMSI_D_1 = #imsi_d_1#
			</isNotEmpty>
			<isNotEmpty property="imsi_d_2" prepend=",">
			IMSI_D_2 = #imsi_d_2#
			</isNotEmpty>
			<isNotEmpty property="imsi_n_1" prepend=",">
			IMSI_N_1 = #imsi_n_1#
			</isNotEmpty>
			<isNotEmpty property="imsi_n_2" prepend=",">
			IMSI_N_2 = #imsi_n_2#
			</isNotEmpty>
			<isNotEmpty property="user_email_receive_yn" prepend=",">
			USER_EMAIL_RECEIVE_YN = #user_email_receive_yn#
			</isNotEmpty>
			<isNotEmpty property="user_sms_receive_yn" prepend=",">
			USER_SMS_RECEIVE_YN = #user_sms_receive_yn#
			</isNotEmpty>
		</dynamic>
		WHERE BOARD_SEQ = #board_seq#
	</update>

	<!-- 게시물 조회수 증가 -->
	<update id="boardCountAdd" parameterClass="int">
		UPDATE BOARD SET
			VIEW_COUNT = VIEW_COUNT+1
		WHERE BOARD_SEQ = #board_seq#
	</update>

	<!-- 새로운 SEQ 를 가져온다. -->
	<select id="getBoardSeq" resultClass="int">
		SELECT NVL(MAX(BOARD_SEQ),0)+1 FROM BOARD
	</select>

	<!-- 댓글의 새로운 SEQ 를 가져온다. -->
	<select id="getBoardCommentSeq" resultClass="int">
		SELECT NVL(MAX(COMMENT_SEQ),0)+1 FROM BOARD_COMMENT
	</select>

	<!-- 게시물을 이동한다. -->
	<update id="moveBoard">
		UPDATE BOARD SET
			MANAGER_SEQ = #move_manager_seq#
		WHERE
			GROUP_SEQ = #board_seq#
	</update>

	<!-- 게시물을 삭제한다.(업데이트) -->
	<update id="deleteBoard" parameterClass="board">
		UPDATE BOARD SET
			DELETE_ID = #delete_id# , DEL_DT = SYSDATE
		WHERE BOARD_SEQ = #board_seq#
	</update>

	<!-- 삭제하기전 하위 게시물이 존재하는지 여부(갯수반환) -->
	<select id="selectChildBoardCount" parameterClass="board" resultClass="int">
		SELECT COUNT(*) FROM BOARD
		WHERE
			PARENT_SEQ = #board_seq# AND
			DEL_DT IS NULL
	</select>

	<!-- 파일다운로드시 증가 -->
	<update id="boardFileCountUp">
		UPDATE BOARD SET
			BOARD_FILE_DOWNLOAD_COUNT = BOARD_FILE_DOWNLOAD_COUNT+1
		WHERE BOARD_SEQ = #board_seq#
	</update>

	<!-- 새로운 게시물 파일의 SEQ 를 가져온다. -->
	<select id="getBoardFileSeq" resultClass="int">
		SELECT NVL(MAX(FILE_SEQ),0)+1 FROM BOARD_FILE
	</select>

	<!-- 게시물 파일 목록 -->
	<select id="selectBoardFile" parameterClass="int" resultClass="boardFile">
		SELECT
			FILE_SEQ , BOARD_SEQ , REAL_FILE_NAME ,
			RENAME_FILE_NAME , FILE_SIZE , FILE_EXT ,
			FILE_ADD_DATE
		FROM BOARD_FILE
		WHERE BOARD_SEQ = #board_seq#
		ORDER BY FILE_SEQ ASC
	</select>

	<!-- 게시물 파일 상세정보를 가져온다. -->
	<select id="boardFileInfo" parameterClass="int" resultClass="boardFile">
		SELECT
			<include refid="boardFileField"/>
		FROM BOARD_FILE
		WHERE FILE_SEQ = #file_Seq#
	</select>

	<!-- 게시물 파일을 등록한다. -->
	<insert id="addBoardFile" parameterClass="boardFile">
		INSERT INTO BOARD_FILE
		(
			<include refid="boardFileField"/>
		) VALUES (
			#file_seq# , #board_seq# , #real_file_name# ,
			#rename_file_name# , #file_size# , #file_ext# ,
			SYSDATE
		)
	</insert>

	<!-- 게시물 파일을 삭제한다. -->
	<delete id="deleteBoardFile" parameterClass="int">
		DELETE BOARD_FILE
		WHERE FILE_SEQ = #file_seq#
	</delete>

	<!-- 특정 게시물에 등록된 파일을 모두 삭제한다. -->
	<delete id="allDeleteBoardFile" parameterClass="int">
		DELETE BOARD_FILE
		WHERE BOARD_SEQ = #board_seq#
	</delete>

	<!-- 삭제 게시물 다음글 가져오기 -->
	<select id="deleteBoardPreView" parameterClass="board" resultClass="board">
		SELECT * FROM
		(
		    SELECT * FROM
		    (
		        SELECT A_BOARD.*,ROWNUM RN FROM
		        (
		            SELECT * FROM
		            (
		                SELECT BOARD_SEQ , TITLE , PARENT_SEQ , GROUP_SEQ , CRT_DT , GROUP_STEP FROM BOARD
		                WHERE
		                    MANAGER_SEQ = #manager_seq# AND
		                    DEL_DT IS NULL
		            )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		            ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		        ) A_BOARD
		    ) WHERE RN <![CDATA[>]]>
		     (
		         SELECT RN FROM
		         (
		             SELECT B_BOARD.*,ROWNUM RN FROM
		             (
		                 SELECT * FROM
		                 (
		                     SELECT BOARD_SEQ , PARENT_SEQ , GROUP_SEQ , GROUP_STEP FROM BOARD
		                     WHERE
		                         MANAGER_SEQ = #manager_seq# AND
		                         DEL_DT IS NOT NULL
		                 )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		                 ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		             ) B_BOARD
		         ) WHERE BOARD_SEQ = #board_seq#
		     ) ORDER BY RN ASC
		 ) WHERE ROWNUM = 1
	</select>

	<!-- 삭제 게시물 이전글 가져오기 -->
	<select id="deleteBoardNextView" parameterClass="board" resultClass="board">
		SELECT * FROM
		(
		    SELECT * FROM
		    (
		        SELECT A_BOARD.*,ROWNUM RN FROM
		        (
		            SELECT * FROM
		            (
		                SELECT BOARD_SEQ , TITLE , PARENT_SEQ , GROUP_SEQ , CRT_DT , GROUP_STEP FROM BOARD
		                WHERE
		                    MANAGER_SEQ = #manager_seq# AND
		                    DEL_DT IS NULL
		            )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		            ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		        ) A_BOARD
		    ) WHERE RN <![CDATA[<]]>
		     (
		         SELECT RN FROM
		         (
		             SELECT B_BOARD.*,ROWNUM RN FROM
		             (
		                 SELECT * FROM
		                 (
		                     SELECT BOARD_SEQ , PARENT_SEQ , GROUP_SEQ , GROUP_STEP FROM BOARD
		                     WHERE
		                         MANAGER_SEQ = #manager_seq# AND
		                         DEL_DT IS NOT NULL
		                 )   CONNECT BY PRIOR BOARD_SEQ = PARENT_SEQ START WITH PARENT_SEQ = 0
		                 ORDER SIBLINGS BY GROUP_SEQ DESC , GROUP_STEP ASC
		             ) B_BOARD
		         ) WHERE BOARD_SEQ = #board_seq#
		     ) ORDER BY RN DESC
		 ) WHERE ROWNUM = 1
	</select>

	<!-- 삭제된 부모 게시물 존재 여부(갯수 반환) -->
	<select id="selectDeleteParentBoardCount" parameterClass="board" resultClass="int">
		SELECT COUNT(*) FROM BOARD
		WHERE
			BOARD_SEQ = #parent_seq# AND
			DEL_DT IS NOT NULL
	</select>

	<!-- 삭제된 자식 게시물 존재 여부(갯수 반환) -->
	<select id="selectDeleteChildBoardCount" resultClass="int">
		SELECT COUNT(*) FROM BOARD
		WHERE
			PARENT_SEQ = #board_seq# AND
			DEL_DT IS NOT NULL
	</select>

	<!-- 삭제된 게시물 복구 -->
	<update id="deleteBoardRecovery" parameterClass="board">
		UPDATE BOARD SET
			DEL_DT = NULL ,
			DELETE_ID = NULL
		WHERE
			BOARD_SEQ = #board_seq#
	</update>

	<!-- 게시물 완전 삭제 -->
	<delete id="absoluteDeleteBoard">
		DELETE BOARD WHERE BOARD_SEQ = #board_seq# AND MANAGER_SEQ = #manager_seq#
	</delete>

	<!-- 게시물 댓글 목록을 가져온다. -->
	<select id="selectBoardComment" parameterClass="int" resultClass="boardComment">
		SELECT
		<include refid="boardCommentField"/>
		FROM BOARD_COMMENT
		WHERE BOARD_SEQ = #board_seq#
		ORDER BY COMMENT_SEQ ASC
	</select>

	<!-- 게시물 댓글을 가져온다. -->
	<select id="selectBoardCommentInfo" parameterClass="boardComment" resultClass="boardComment">
		SELECT
		<include refid="boardCommentField"/>
		FROM BOARD_COMMENT
		WHERE BOARD_SEQ = #board_seq# AND COMMENT_SEQ = #comment_seq#
	</select>

	<!-- 게시물 댓글을 등록한다. -->
	<insert id="addBoardComment" parameterClass="boardComment">
		INSERT INTO BOARD_COMMENT
		(
		<include refid="boardCommentField"/>
		) VALUES
		(
			#comment_seq# , #board_seq# , #comment_add_user_id# ,
			#comment_add_user_name# , SYSDATE , #comment_content#,
			#emoticon#
		)
	</insert>

	<!-- 게시물 댓글을 수정한다. -->
	<update id="modifyBoardComment" parameterClass="boardComment">
		UPDATE BOARD_COMMENT SET
			COMMENT_CONTENT = #comment_content#
		WHERE
			COMMENT_SEQ = #comment_seq# AND
			BOARD_SEQ = #board_seq#
	</update>

	<!-- 게시물 댓글을 삭제한다. -->
	<delete id="deleteBoardComment" parameterClass="boardComment">
		DELETE BOARD_COMMENT
		WHERE
			COMMENT_SEQ = #comment_seq# AND
			BOARD_SEQ = #board_seq#
	</delete>

	<!-- 소속된 게시물 댓글을 모두 삭제한다. -->
	<delete id="allDeleteBoardComment" parameterClass="int">
		DELETE BOARD_COMMENT
		WHERE
			BOARD_SEQ = #board_seq#
	</delete>

	<!-- 게시물의 신고 상태를 바꾼다. -->
	<update id="modifyBoardReportState" parameterClass="boardReport">
		UPDATE BOARD SET
			REPORT_STATE = #report_state#
		WHERE
			BOARD_SEQ = #board_seq#
	</update>

	<!-- 신고된 게시물의 새로운 순번을 가져온다 -->
	<select id="getBoardReportSeq" resultClass="int">
		SELECT NVL(MAX(REP_SEQ),0)+1 FROM BOARD_REPORT
	</select>

	<!-- 신고된 게시물을 등록한다. -->
	<insert id="addReportBoard" parameterClass="boardReport">
		INSERT INTO BOARD_REPORT
		(
		    <include refid="boardReportField"/>
		) VALUES (
		    #rep_seq#, #board_seq#, #user_id#,
		    #content#, SYSDATE
		)
	</insert>

	<!-- 신고 여부 확인 -->
	<select id="selectExistBoardReportCount" parameterClass="boardReport" resultClass="int">
		SELECT
			COUNT(*)
		FROM
			BOARD_REPORT
    	WHERE
    		BOARD_SEQ = #board_seq# AND
    		USER_ID = #user_id#
	</select>

	<!-- 추천 여부 확인 -->
	<select id="selectExistBoardRecomCount" parameterClass="boardRecom" resultClass="int">
		SELECT
			COUNT(*)
		FROM
			BOARD_RECOM
    	WHERE
    		BOARD_SEQ = #board_seq# AND
    		USER_ID = #user_id#
	</select>

	<!-- 게시물의 추천 회수를 높인다. -->
	<update id="boardRecomCountAdd" parameterClass="int">
		UPDATE BOARD SET
			RECOM_COUNT = RECOM_COUNT+1
		WHERE BOARD_SEQ = #board_seq#
	</update>

	<!-- 추천된 게시물의 새로운 순번을 가져온다 -->
	<select id="getBoardRecomSeq" resultClass="int">
		SELECT NVL(MAX(RECOM_SEQ),0)+1 FROM BOARD_RECOM
	</select>

	<!-- 추천된 게시물을 등록한다. -->
	<insert id="addRecomBoard" parameterClass="boardRecom">
		INSERT INTO BOARD_RECOM
		(
		    <include refid="boardRecomField"/>
		) VALUES (
		    #recom_seq#, #board_seq#, #user_id#,
		    SYSDATE
		)
	</insert>

</sqlMap>